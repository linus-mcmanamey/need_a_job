# Requirements Traceability Matrix - Story 7.1
**Generated:** 2025-10-30
**Reviewer:** Quinn (Test Architect)
**Story:** 7.1 Vue 3 Frontend Migration

---

## AC 1: WebSocket Support Added to FastAPI

### Given-When-Then Scenarios

**Scenario 1.1: ConnectionManager Created**
- **Given** the backend needs WebSocket functionality
- **When** `app/ui/websocket.py` is created
- **Then** ConnectionManager class exists with connect(), disconnect(), broadcast() methods
- **Evidence**: ✅ File exists, class implemented
- **Test Coverage**: `tests/ui/test_websocket.py` (5/10 passing - needs pytest-mock)

**Scenario 1.2: WebSocket Endpoint**
- **Given** clients need to connect to real-time updates
- **When** `/ws/status` endpoint is accessed
- **Then** WebSocket connection is established and managed
- **Evidence**: ✅ Endpoint implemented in `app/main.py:114-128`
- **Test Coverage**: ✅ `test_websocket_endpoint_exists`, `test_websocket_connection` passing

**Scenario 1.3: State Change Broadcasts**
- **Given** job status changes in the system
- **When** retry/approve/reject actions occur
- **Then** WebSocket broadcasts job_update/job_retry events
- **Evidence**: ✅ Implemented in API endpoints (lines 133-293 in app/main.py)
- **Test Coverage**: ⚠️ Unit tests for broadcast exist but require pytest-mock

**Status**: ✅ PASS (core functionality implemented, minor test dependency issue)

---

## AC 2: Vue 3 Frontend Project Created

### Given-When-Then Scenarios

**Scenario 2.1: Project Initialization**
- **Given** need for modern frontend framework
- **When** Vite template is scaffolded
- **Then** Vue 3 project exists in `frontend/` directory
- **Evidence**: ✅ Complete project structure with 86 npm packages
- **Test Coverage**: Manual verification - project structure exists

**Scenario 2.2: Dependencies Installed**
- **Given** frontend needs state management and HTTP client
- **When** axios, pinia, vue-router, tailwindcss are installed
- **Then** all dependencies are available in node_modules
- **Evidence**: ✅ Verified via `npm list --depth=0`
- **Test Coverage**: Manual verification - all packages present

**Scenario 2.3: Environment Configuration**
- **Given** different environments (dev/prod) need different configs
- **When** .env files are created
- **Then** API_URL and WS_URL are configurable per environment
- **Evidence**: ✅ .env.example, .env.development, .env.production exist
- **Test Coverage**: Manual verification - files exist with correct variables

**Status**: ✅ PASS (complete project setup)

---

## AC 3: Frontend Components Implemented

### Given-When-Then Scenarios

**Scenario 3.1: Dashboard Component**
- **Given** users need overview of application status
- **When** Dashboard.vue loads
- **Then** 4 stats cards and 3 tabs are displayed
- **Evidence**: ✅ Component exists, implements stats and tabs
- **Test Coverage**: ⚠️ Manual testing only (no unit tests yet)

**Scenario 3.2: JobTable Component**
- **Given** users need to view and manage jobs
- **When** JobTable.vue renders
- **Then** jobs list with status badges and retry buttons appear
- **Evidence**: ✅ Component exists with full functionality
- **Test Coverage**: ⚠️ Manual testing only

**Scenario 3.3: PipelineView Component**
- **Given** users need to monitor pipeline status
- **When** PipelineView.vue renders
- **Then** pipeline metrics and active jobs are displayed
- **Evidence**: ✅ Component exists with metrics cards
- **Test Coverage**: ⚠️ Manual testing only

**Scenario 3.4: PendingJobs Component**
- **Given** users need to approve/reject pending jobs
- **When** PendingJobs.vue renders
- **Then** pending jobs with approve/reject buttons are shown
- **Evidence**: ✅ Component exists with action buttons
- **Test Coverage**: ⚠️ Manual testing only

**Status**: ✅ PASS (all components implemented - test gap noted)

---

## AC 4: State Management & API Integration

### Given-When-Then Scenarios

**Scenario 4.1: Pinia Store**
- **Given** frontend needs centralized state management
- **When** jobStore.js is created
- **Then** reactive state for jobs/pipeline/pending is available
- **Evidence**: ✅ Store implemented with all required state
- **Test Coverage**: ⚠️ No unit tests (manual testing only)

**Scenario 4.2: API Client**
- **Given** frontend needs to communicate with backend
- **When** services/api.js is created
- **Then** HTTP methods for all endpoints are available
- **Evidence**: ✅ Axios client with jobsAPI, pipelineAPI, pendingAPI
- **Test Coverage**: ⚠️ No unit tests

**Scenario 4.3: WebSocket Client**
- **Given** frontend needs real-time updates
- **When** services/websocket.js is created
- **Then** WebSocket client with auto-reconnect is available
- **Evidence**: ✅ Client with 10-attempt reconnect logic
- **Test Coverage**: ⚠️ No unit tests

**Scenario 4.4: Real-time Updates**
- **Given** backend broadcasts state changes
- **When** WebSocket receives job_update/pipeline_update events
- **Then** store refreshes data automatically
- **Evidence**: ✅ Handlers registered in jobStore.js
- **Test Coverage**: ⚠️ Requires integration testing

**Status**: ✅ PASS (functionality complete - test gap)

---

## AC 5: Docker Configuration Updated

### Given-When-Then Scenarios

**Scenario 5.1: docker-compose.yml Updated**
- **Given** frontend service needs to run in Docker
- **When** docker-compose.yml is updated
- **Then** frontend service is defined with correct ports and volumes
- **Evidence**: ✅ Frontend service added (lines 6-26 in docker-compose.yml)
- **Test Coverage**: ✅ `docker-compose config --quiet` passes

**Scenario 5.2: Frontend Dockerfile**
- **Given** frontend needs containerization
- **When** frontend/Dockerfile is created
- **Then** multi-stage build with dev/prod targets exists
- **Evidence**: ✅ Dockerfile with base, build, production stages
- **Test Coverage**: Manual - Dockerfile exists and structured correctly

**Scenario 5.3: Backend Dockerfile Updated**
- **Given** Gradio is being removed
- **When** backend Dockerfile is updated
- **Then** Gradio references are removed
- **Evidence**: ✅ Port 7860 removed, start_services.sh removed
- **Test Coverage**: Manual verification

**Scenario 5.4: Services Start**
- **Given** all services are configured
- **When** `docker-compose up` is executed
- **Then** frontend (5173), backend (8000), redis (6379) start successfully
- **Evidence**: ⚠️ Not verified in test run (needs full system test)
- **Test Coverage**: Task 8 manual testing required

**Status**: ⚠️ CONCERNS (configuration complete, startup not verified)

---

## AC 6: Gradio Removal Complete

### Given-When-Then Scenarios

**Scenario 6.1: Gradio File Deleted**
- **Given** Gradio UI is being replaced
- **When** cleanup is performed
- **Then** app/ui/gradio_app.py no longer exists
- **Evidence**: ✅ File deleted successfully
- **Test Coverage**: Manual verification - file not in git status

**Scenario 6.2: Dependencies Removed**
- **Given** Gradio is no longer needed
- **When** pyproject.toml is updated
- **Then** Gradio dependency is removed
- **Evidence**: ✅ Removed from pyproject.toml and requirements.txt
- **Test Coverage**: ✅ Grep shows no gradio imports in .py files

**Scenario 6.3: Import Cleanup**
- **Given** code may reference Gradio
- **When** codebase is searched for gradio imports
- **Then** no imports remain in Python files
- **Evidence**: ✅ `grep -r "import gradio"` returns no .py files
- **Test Coverage**: ✅ Test files updated to remove gradio tests

**Status**: ✅ PASS (complete removal)

---

## AC 7: Testing & Verification

### Given-When-Then Scenarios

**Scenario 7.1: Dashboard Loads**
- **Given** frontend is accessed
- **When** http://localhost:5173 is loaded
- **Then** dashboard renders without errors
- **Evidence**: ⚠️ Not verified (Task 8 pending)
- **Test Coverage**: Manual testing required

**Scenario 7.2: WebSocket Connection**
- **Given** dashboard is loaded
- **When** WebSocket attempts to connect
- **Then** connection to ws://localhost:8000/ws/status succeeds
- **Evidence**: ⚠️ Not verified (Task 8 pending)
- **Test Coverage**: Browser DevTools verification needed

**Scenario 7.3: Real-time Updates**
- **Given** WebSocket is connected
- **When** job status changes
- **Then** UI updates automatically without refresh
- **Evidence**: ⚠️ Not verified (Task 8 pending)
- **Test Coverage**: Integration testing required

**Scenario 7.4: User Interactions**
- **Given** jobs are displayed
- **When** retry/approve/reject buttons are clicked
- **Then** API calls succeed and UI updates
- **Evidence**: ⚠️ Not verified (Task 8 pending)
- **Test Coverage**: E2E testing required

**Status**: ⚠️ CONCERNS (implementation complete, testing not executed)

---

## AC 8: Documentation

### Given-When-Then Scenarios

**Scenario 8.1: README Updated**
- **Given** setup process has changed
- **When** README.md is reviewed
- **Then** Vue 3 setup instructions are documented
- **Evidence**: ✅ README fully updated with Vue 3 information
- **Test Coverage**: Manual review - comprehensive updates made

**Scenario 8.2: Environment Variables Documented**
- **Given** developers need configuration guidance
- **When** README is consulted
- **Then** all VITE_* variables are explained
- **Evidence**: ✅ Environment variables section updated
- **Test Coverage**: Manual review

**Scenario 8.3: Deployment Notes**
- **Given** system needs production deployment
- **When** deployment documentation is reviewed
- **Then** production build process is documented
- **Evidence**: ✅ Deployment section with build/serve options
- **Test Coverage**: Manual review

**Status**: ✅ PASS (comprehensive documentation)

---

## Coverage Summary

| AC | Status | Evidence | Test Coverage |
|----|--------|----------|---------------|
| AC 1 | ✅ PASS | Complete implementation | 5/10 tests passing (pytest-mock needed) |
| AC 2 | ✅ PASS | Complete setup | Manual verification |
| AC 3 | ✅ PASS | All components built | Manual testing only |
| AC 4 | ✅ PASS | Full integration | Manual testing only |
| AC 5 | ⚠️ CONCERNS | Config complete | Startup not verified |
| AC 6 | ✅ PASS | Complete removal | Grep verification |
| AC 7 | ⚠️ CONCERNS | Code complete | Testing not executed |
| AC 8 | ✅ PASS | Comprehensive docs | Manual review |

---

## Gap Analysis

### Critical Gaps (Must Address)
1. **Task 8 Testing Not Executed**: Functional, WebSocket, and interaction tests not performed
2. **Docker Startup Not Verified**: `docker-compose up` success not confirmed
3. **Real-time Updates Not Tested**: WebSocket broadcast/receive flow not validated

### Important Gaps (Should Address)
4. **Frontend Unit Tests**: No unit tests for Vue components, store, or services
5. **WebSocket Test Dependencies**: 5 tests blocked by missing pytest-mock package
6. **Integration Tests**: No automated integration tests for WebSocket + frontend flow

### Nice to Have (Future)
7. **E2E Tests**: No Playwright/Cypress tests for full user flows
8. **Performance Tests**: No load testing for WebSocket connections
9. **Accessibility Tests**: No a11y validation for UI components

---

## Recommendations

### Immediate (Before Production)
1. **Execute Task 8 Manual Testing**: Follow TESTING_GUIDE_TASK_8.md checklist
2. **Install pytest-mock**: Run `poetry add --dev pytest-mock` to fix 5 test failures
3. **Verify Docker Startup**: Execute `docker-compose up --build` and validate all services

### Short-term (Next Sprint)
4. **Add Frontend Unit Tests**: Vitest for store actions and WebSocket client
5. **Add Integration Tests**: Test WebSocket message flow end-to-end
6. **Performance Testing**: Load test WebSocket with multiple concurrent connections

### Long-term (V2)
7. **E2E Test Suite**: Implement Playwright tests for critical user flows
8. **Accessibility Audit**: Run axe-core on all Vue components
9. **Visual Regression Tests**: Implement Percy or similar for UI consistency

---

## Overall Assessment

**Implementation Quality**: ✅ Excellent (clean code, well-structured, follows patterns)

**Test Coverage**: ⚠️ Adequate for MVP (backend basic tests pass, frontend needs manual validation)

**Risk Level**: **MEDIUM** (implementation solid, but Task 8 testing not executed - manual validation critical before production)

**Recommended Action**: **CONCERNS** gate - Manual testing must be completed before marking story as Done
