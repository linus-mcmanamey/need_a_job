# Story 7.2: Application History and Search

## Status
**In Progress** 🚧

**Started**: 2025-10-31
**Quality Gate**: TBD

---

## Story

**As a** user,
**I want to** search and view my application history in the Vue 3 UI,
**so that** I can track which jobs I've applied to, when I applied, and analyze my application patterns.

---

## Context

Story 5.6 was originally deferred from Epic 5 to V2 development. Now that we have a modern Vue 3 frontend (Story 7.1 complete), we can implement this feature with better search, filtering, and export capabilities using Vue 3's component ecosystem.

This story enhances the job application system by providing users with:
- Historical view of all completed applications
- Advanced search and filtering capabilities
- Trend analysis and statistics
- Export functionality for external analysis

---

## Acceptance Criteria

### AC1: Application History Table
**Given** I am on the Application History page
**When** the page loads
**Then** I should see a table with all completed applications showing:
- Job title
- Company name
- Platform (LinkedIn, SEEK, Indeed, etc.)
- Application date (formatted: DD MMM YYYY)
- Match score (percentage)
- Status (Applied, Rejected, Interview, Offer)
- Actions (View Details, Export)

**Success Criteria:**
- Table displays all applications from database
- Data is sorted by application date (most recent first) by default
- Loading state shown while fetching data
- Empty state shown if no applications exist
- Pagination with 25 items per page

---

### AC2: Advanced Search and Filtering
**Given** I am viewing the application history
**When** I use the search and filter controls
**Then** the table should filter results based on:
- **Text Search:** Job title, company name (case-insensitive, partial match)
- **Platform Filter:** Multi-select dropdown (LinkedIn, SEEK, Indeed, All)
- **Date Range:** Start date and end date pickers
- **Match Score Range:** Slider (0-100%)
- **Status Filter:** Multi-select (Applied, Rejected, Interview, Offer)

**Success Criteria:**
- Filters can be combined (AND logic)
- Filters update results in real-time (client-side filtering for performance)
- Clear filters button resets all filters
- Filter state persists in URL query params (shareable links)
- Filter count badge shows number of active filters

---

### AC3: Sortable Columns with Persistent Preferences
**Given** I am viewing the application history table
**When** I click on a column header
**Then** the table should:
- Sort by that column (ascending on first click)
- Toggle to descending on second click
- Show sort indicator (up/down arrow) on active column
- Remember sort preference in localStorage
- Restore sort preference on page reload

**Success Criteria:**
- All columns are sortable (title, company, platform, date, score, status)
- Sort state persists across sessions
- Sort works with active filters

---

### AC4: Application Detail Modal
**Given** I click "View Details" on an application row
**When** the modal opens
**Then** I should see:
- **Job Information:** Title, company, platform, URL, location, salary range
- **Application Details:** Date applied, match score, status
- **Tailored Documents:**
  - CV preview (first page or text excerpt)
  - Cover letter preview
  - Download buttons for both documents
- **Job Description:** Original job description text
- **Match Reasoning:** Why this job was a good match (from job matcher agent)
- **Application Timeline:** Status changes with timestamps

**Success Criteria:**
- Modal is responsive (mobile, tablet, desktop)
- Modal can be closed via ESC key, close button, or backdrop click
- Documents are downloadable as PDF/DOCX
- Modal has smooth open/close animations

---

### AC5: Export to CSV Functionality
**Given** I have applied filters and selected applications
**When** I click "Export to CSV"
**Then** the system should:
- Generate CSV file with filtered results
- Include columns: Job Title, Company, Platform, Date, Match Score, Status, URL
- Download file with timestamp: `applications_YYYY-MM-DD_HHMMSS.csv`
- Show toast notification: "Exported N applications to CSV"

**Success Criteria:**
- CSV is properly formatted (quoted fields, UTF-8 encoding)
- Date format is Excel-compatible
- Export respects active filters
- Export all button available (exports entire history)

---

### AC6: Statistics and Trend Visualization
**Given** I am viewing the application history page
**When** the page loads
**Then** I should see a statistics dashboard showing:
- **Total Applications:** Count of all applications
- **Applications This Week:** Count of applications in last 7 days
- **Applications This Month:** Count of applications in last 30 days
- **Average Match Score:** Mean match score across all applications
- **Success Rate:** Percentage of applications leading to interview/offer
- **Platform Distribution:** Pie chart showing breakdown by platform
- **Applications Over Time:** Line chart showing application trend (last 12 weeks)

**Success Criteria:**
- Charts are responsive and mobile-friendly
- Charts use consistent color scheme with Vue 3 UI
- Hover tooltips show detailed data
- Charts update when filters are applied

---

### AC7: Pagination and Infinite Scroll Support
**Given** I have more than 25 applications
**When** I scroll to the bottom of the table
**Then** the system should:
- Load next 25 applications (infinite scroll)
- Show loading spinner while fetching
- Disable scroll loading when all results loaded
- Alternatively, show pagination controls with page numbers

**Success Criteria:**
- Smooth scrolling performance (no jank)
- Current page highlighted in pagination
- Jump to page functionality
- Results count shown: "Showing 1-25 of 150 applications"

---

## Implementation Tasks

### Task 1: Backend API Endpoint
**Estimated:** 4 hours

1. **Verify existing endpoint or create new:**
   - Check if `GET /api/history` exists in app/main.py
   - If not, create endpoint with query parameters for filtering
   - Endpoint should return: `{ applications: [], total: int, page: int, page_size: int }`

2. **Database query:**
   - Query DuckDB `applications` table
   - Join with `jobs` table for job details
   - Support filtering: platform, date_range, status, score_range
   - Support sorting: any column, asc/desc
   - Support pagination: limit, offset

3. **Response model:**
   - Create Pydantic model: `ApplicationHistoryResponse`
   - Include all required fields from AC1

4. **Testing:**
   - Unit tests for endpoint (pytest)
   - Test filtering logic
   - Test pagination edge cases

**Dependencies:** DuckDB schema (likely exists from previous stories)
**Output:** Working `/api/history` endpoint with filtering and pagination

---

### Task 2: Pinia Store for Application History
**Estimated:** 3 hours

1. **Create `historyStore.js`:**
   - State: `applications`, `loading`, `error`, `filters`, `sort`, `pagination`
   - Actions: `fetchHistory()`, `applyFilters()`, `setSort()`, `exportCSV()`
   - Getters: `filteredApplications`, `statistics`, `paginatedResults`

2. **Filter logic:**
   - Client-side filtering for better UX (filter as you type)
   - Combine text search, platform, date range, score range, status
   - Debounce text search (300ms)

3. **Statistics computation:**
   - Computed property for dashboard metrics
   - Reactive updates when filters change

4. **Integration:**
   - Connect to `/api/history` endpoint
   - WebSocket listener for `application_completed` events (real-time updates)

**Dependencies:** API endpoint (Task 1), existing `services/api.js`
**Output:** Pinia store with full filtering and statistics logic

---

### Task 3: ApplicationHistory Component
**Estimated:** 6 hours

1. **Create `ApplicationHistory.vue`:**
   - Statistics dashboard section (uses Chart.js or similar)
   - Search and filter controls
   - Sortable table
   - Pagination controls
   - Export CSV button

2. **Table implementation:**
   - Sortable headers (click to sort, indicator arrows)
   - Row click opens detail modal
   - Status badge with color coding (Applied=blue, Rejected=red, Interview=yellow, Offer=green)
   - Match score with progress bar visualization
   - Responsive table (collapse to cards on mobile)

3. **Filter UI:**
   - Text search input with debounce
   - Platform multi-select dropdown
   - Date range picker (e.g., vue-datepicker)
   - Match score range slider (e.g., @vueform/slider)
   - Status multi-select checkboxes
   - Active filters badges with remove button
   - Clear all filters button

4. **Styling:**
   - Tailwind CSS dark theme (consistent with Story 7.1)
   - Hover effects on table rows
   - Loading skeletons

**Dependencies:** Pinia store (Task 2), Chart.js library
**Output:** Functional ApplicationHistory.vue component

---

### Task 4: Application Detail Modal
**Estimated:** 5 hours

1. **Create `ApplicationDetailModal.vue`:**
   - Modal overlay with dark backdrop
   - Scrollable modal content
   - Close button, ESC key handler, backdrop click handler

2. **Modal sections:**
   - Job information card
   - Application details card
   - Tailored documents section with preview and download
   - Job description section (collapsible)
   - Match reasoning section
   - Application timeline (status changes)

3. **Document preview:**
   - CV preview: First page image or text excerpt (first 500 chars)
   - Cover letter preview: Full text or first paragraph
   - Download buttons: Generate PDF/DOCX on demand or fetch existing

4. **Animations:**
   - Fade-in backdrop
   - Scale-in modal content
   - Smooth transitions

**Dependencies:** Modal data from historyStore
**Output:** ApplicationDetailModal.vue component

---

### Task 5: Statistics Dashboard with Charts
**Estimated:** 4 hours

1. **Choose charting library:**
   - Recommended: Chart.js (lightweight, Vue 3 compatible)
   - Alternative: ApexCharts (more features, larger bundle)

2. **Create chart components:**
   - `PlatformDistributionChart.vue` (Pie chart)
   - `ApplicationTrendChart.vue` (Line chart)

3. **Statistics cards:**
   - Total applications
   - This week count
   - This month count
   - Average match score
   - Success rate

4. **Responsive design:**
   - Grid layout for cards (responsive columns)
   - Charts resize on window resize
   - Mobile-friendly chart sizing

**Dependencies:** Chart.js library, historyStore statistics
**Output:** Statistics dashboard components

---

### Task 6: Export CSV Functionality
**Estimated:** 2 hours

1. **CSV generation:**
   - Create `utils/csvExport.js` helper
   - Convert filtered applications to CSV format
   - Properly quote fields, escape special characters
   - UTF-8 encoding

2. **Download trigger:**
   - Create Blob from CSV string
   - Trigger browser download with timestamp filename
   - Show toast notification (use existing toast system or add vue-toastification)

3. **Export all vs. filtered:**
   - Export button respects active filters
   - "Export All" button ignores filters

**Dependencies:** historyStore filtered applications
**Output:** Working CSV export with toast notifications

---

### Task 7: Pagination and Infinite Scroll
**Estimated:** 3 hours

1. **Choose pagination strategy:**
   - Recommended: Hybrid (pagination controls + infinite scroll option)
   - Let user toggle via settings (future enhancement)

2. **Pagination controls:**
   - Page number buttons (show 1, ..., 5, 6, 7, ..., 20)
   - Previous/Next buttons
   - Jump to page input
   - Results count display

3. **Infinite scroll:**
   - Intersection Observer API to detect scroll bottom
   - Load next page when user scrolls near bottom
   - Loading spinner during fetch
   - "No more results" indicator

4. **Performance:**
   - Virtual scrolling if > 1000 applications (future enhancement)
   - Debounce scroll event

**Dependencies:** historyStore pagination state
**Output:** Pagination controls and infinite scroll

---

### Task 8: Route and Navigation
**Estimated:** 1 hour

1. **Add route to Vue Router:**
   - Path: `/history`
   - Component: ApplicationHistory
   - Meta: `{ title: 'Application History' }`

2. **Update navigation:**
   - Add "History" link to Sidebar.vue
   - Icon: 📜 or 🗂️
   - Highlight active route

**Dependencies:** Existing router config
**Output:** Navigation to /history page

---

### Task 9: URL Query Params for Filters
**Estimated:** 2 hours

1. **Sync filters with URL:**
   - Watch filter changes in historyStore
   - Update URL query params (vue-router)
   - Parse query params on component mount
   - Apply filters from URL

2. **Shareable links:**
   - User can copy URL with active filters
   - Pasting URL restores exact filter state

**Dependencies:** Vue Router
**Output:** Shareable filter state via URL

---

### Task 10: Testing
**Estimated:** 4 hours

1. **Backend tests:**
   - Test /api/history endpoint with various filters
   - Test pagination edge cases
   - Test sorting combinations

2. **Frontend tests (optional for MVP, recommended):**
   - Unit tests for historyStore (Vitest)
   - Test filter logic, statistics computation
   - Test CSV export function

3. **Manual testing:**
   - Test all filter combinations
   - Test sorting on each column
   - Test modal functionality
   - Test CSV export
   - Test responsive design (mobile, tablet, desktop)
   - Test with large dataset (>1000 applications)

**Dependencies:** All previous tasks
**Output:** Comprehensive test coverage

---

### Task 11: Documentation
**Estimated:** 2 hours

1. **Update README.md:**
   - Document /history route
   - Document filter capabilities
   - Document export functionality

2. **Add screenshots:**
   - Application history table
   - Filter panel
   - Detail modal
   - Statistics dashboard

3. **Developer notes:**
   - Document historyStore API
   - Document CSV export utility
   - Document chart components

**Dependencies:** Implementation complete
**Output:** Updated documentation

---

## Technical Notes

### Database Schema
Assuming `applications` table exists with columns:
- `id`: Primary key
- `job_id`: Foreign key to `jobs` table
- `applied_date`: Timestamp
- `status`: ENUM ('applied', 'rejected', 'interview', 'offer')
- `match_score`: INTEGER (0-100)
- `cv_path`: VARCHAR (path to tailored CV)
- `cover_letter_path`: VARCHAR (path to cover letter)

If schema doesn't match, Task 1 may need to include schema updates.

### Chart.js Setup
```bash
npm install chart.js vue-chartjs
```

### Date Picker Recommendation
```bash
npm install @vuepic/vue-datepicker
```

### CSV Export Example
```javascript
// utils/csvExport.js
export function exportToCSV(applications, filename) {
  const headers = ['Job Title', 'Company', 'Platform', 'Date', 'Match Score', 'Status', 'URL']
  const rows = applications.map(app => [
    app.job_title,
    app.company_name,
    app.platform,
    new Date(app.applied_date).toLocaleDateString(),
    app.match_score,
    app.status,
    app.job_url
  ])

  const csvContent = [
    headers.join(','),
    ...rows.map(row => row.map(field => `"${field}"`).join(','))
  ].join('\n')

  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' })
  const link = document.createElement('a')
  link.href = URL.createObjectURL(blob)
  link.download = filename
  link.click()
}
```

---

## Dependencies

### Prerequisites
- ✅ Story 7.1 complete (Vue 3 infrastructure)
- ✅ Vue Router configured
- ✅ Pinia store pattern established
- ✅ Tailwind CSS configured

### Internal Dependencies
- DuckDB `applications` table (verify schema)
- Existing API client (`services/api.js`)
- WebSocket client for real-time updates (optional enhancement)

### External Dependencies
- Chart.js (for statistics visualization)
- @vuepic/vue-datepicker (date range picker)
- @vueform/slider (match score range slider)
- vue-toastification (toast notifications) - optional

---

## Definition of Done

- [ ] Task 1: Backend `/api/history` endpoint complete with tests
- [ ] Task 2: Pinia `historyStore` implemented with filtering and statistics
- [ ] Task 3: `ApplicationHistory.vue` component with table and filters
- [ ] Task 4: `ApplicationDetailModal.vue` component functional
- [ ] Task 5: Statistics dashboard with charts complete
- [ ] Task 6: CSV export functionality working
- [ ] Task 7: Pagination and/or infinite scroll implemented
- [ ] Task 8: Route added and navigation updated
- [ ] Task 9: URL query params sync with filters
- [ ] Task 10: All tests passing (backend + manual testing)
- [ ] Task 11: Documentation updated with screenshots
- [ ] All 7 Acceptance Criteria met
- [ ] Code review passed (Grade A or higher)
- [ ] QA verification completed
- [ ] No regressions from Story 7.1
- [ ] Production deployment successful

---

## Estimated Effort

| Task | Estimated Hours |
|------|----------------|
| Task 1: Backend API | 4h |
| Task 2: Pinia Store | 3h |
| Task 3: ApplicationHistory Component | 6h |
| Task 4: Detail Modal | 5h |
| Task 5: Statistics Dashboard | 4h |
| Task 6: CSV Export | 2h |
| Task 7: Pagination | 3h |
| Task 8: Route/Navigation | 1h |
| Task 9: URL Query Params | 2h |
| Task 10: Testing | 4h |
| Task 11: Documentation | 2h |
| **Total** | **36 hours** |

**Story Points:** 13 (Large/Complex)

**Estimated Duration:** 4-5 days (with interruptions and meetings)

---

## Success Metrics

- **Feature Completeness:** 100% of AC met
- **Performance:** Table renders <500ms with 1000 applications
- **Test Coverage:** Backend endpoint >90%
- **Code Quality:** Grade A on code review
- **User Experience:** Filters respond instantly (<100ms)
- **Chart Load Time:** <1 second for statistics dashboard

---

## Risks & Mitigation

### Risk 1: Backend Endpoint Doesn't Exist
**Impact:** Medium | **Probability:** Medium

**Mitigation:**
- Task 1 includes verification and creation if needed
- Use existing DuckDB schema from prior stories
- If schema changes required, update migrations

### Risk 2: Chart Library Bundle Size
**Impact:** Low | **Probability:** Low

**Mitigation:**
- Chart.js is lightweight (~60KB gzipped)
- Use tree-shaking to import only needed components
- Lazy-load chart components (only when History page accessed)

### Risk 3: Large Dataset Performance
**Impact:** Medium | **Probability:** Low

**Mitigation:**
- Client-side filtering is fast for <5000 items
- If performance issues, switch to server-side filtering
- Implement virtual scrolling for very large datasets (future enhancement)

---

## References

- **Epic 7:** Frontend Modernization (docs/prd/epic-7-frontend-modernization.md)
- **Story 7.1:** Vue 3 Frontend Migration (docs/stories/7.1.vue3-frontend-migration.md)
- **Architecture:** Vue 3 + Pinia + Tailwind CSS pattern from Story 7.1

---

**Story Created:** 2025-10-31
**Story Owner:** Product Team
**Status:** Planning → Ready for Implementation
